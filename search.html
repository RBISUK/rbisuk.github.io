<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Search • RBIS</title>
<link rel="stylesheet" href="/assets/rbis.css">
<main class="container" style="max-width:900px">
  <h1>Search</h1>
  <input id="q" placeholder="Search pages…" aria-label="Search" style="width:100%;padding:.75rem;border-radius:.75rem;margin:.5rem 0">
  <ul id="results"></ul>
</main>
<script>
const q = new URLSearchParams(location.search).get('q')||'';
const inp = document.getElementById('q'); const ul = document.getElementById('results');
inp.value = q;
async function getUrls(){
  const txt = await fetch('/sitemap.xml',{cache:'no-store'}).then(r=>r.text());
  return Array.from(txt.matchAll(/<loc>(.*?)<\/loc>/g)).map(m=>m[1]);
}
function score(u, q){ u=u.toLowerCase(); q=q.toLowerCase(); return u.includes(q) ? q.length : 0; }
function render(urls, q){
  ul.innerHTML = '';
  if(!q) return;
  urls.map(u=>({u, s:score(u,q)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s).slice(0,50)
    .forEach(({u})=>{
      const li=document.createElement('li'); li.innerHTML=`<a href="${u}">${u}</a>`; ul.appendChild(li);
    });
}
let urls=[]; getUrls().then(us=>{urls=us; render(urls,inp.value)});
inp.addEventListener('input', ()=>render(urls, inp.value));
</script>
